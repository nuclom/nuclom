---
title: "Structured Logging"
description: "High-performance structured logging with Pino for production and development"
icon: "scroll"
---

Nuclom uses [Pino](https://github.com/pinojs/pino) for structured logging. This provides high-performance JSON logging in production and human-readable colorized output in development.

## Overview

The logging system provides:

- **Log levels**: debug, info, warn, error
- **Structured JSON format**: For production log aggregation (Vercel, Datadog, etc.)
- **Pretty-printed output**: Colorized, readable logs for development
- **Request context**: Automatic request ID propagation
- **Child loggers**: Component-scoped logging
- **Timed operations**: Duration tracking for performance monitoring

## Quick Start

```typescript
import { logger, createLogger } from "@/lib/logger";

// Use the default logger
logger.info("User logged in", { userId: "123" });
logger.error("Failed to process video", new Error("timeout"), { videoId: "abc" });

// Create a component-specific logger
const log = createLogger("video-processing");
log.info({ videoId: "123" }, "Starting video processing");
log.error({ err: error, videoId: "123" }, "Processing failed");
```

## Log Levels

Configure the log level with the `LOG_LEVEL` environment variable:

| Level | Default In | Description |
|-------|------------|-------------|
| `debug` | development | Detailed debugging information |
| `info` | production | General operational information |
| `warn` | - | Warning conditions |
| `error` | - | Error conditions |

```bash
# In .env
LOG_LEVEL=debug  # Show all logs including debug
LOG_LEVEL=info   # Show info, warn, error (production default)
LOG_LEVEL=warn   # Show only warn and error
LOG_LEVEL=error  # Show only errors
```

## API Reference

### Default Logger

```typescript
import { logger } from "@/lib/logger";

// Debug (only in development or when LOG_LEVEL=debug)
logger.debug("Cache hit", { key: "user:123" });

// Info
logger.info("Order placed", { orderId: "456", amount: 99.99 });

// Warning
logger.warn("Rate limit approaching", { remaining: 10 });

// Error (with optional Error object)
logger.error("Database connection failed", dbError, { host: "db.example.com" });
```

### Creating Component Loggers

Use `createLogger` for component-specific logging:

```typescript
import { createLogger } from "@/lib/logger";

// Creates a child logger with component context
const log = createLogger("video-processing");

// All logs include the component name
log.info({ videoId: "123" }, "Processing started");
// Output: { component: "video-processing", videoId: "123", msg: "Processing started" }
```

### Child Loggers with Context

```typescript
import { logger } from "@/lib/logger";

// Create a child logger with preset context
const requestLogger = logger.child({
  requestId: "abc-123",
  userId: "user-456",
});

requestLogger.info("Processing request");
// Output includes requestId and userId automatically
```

### Timed Operations

```typescript
import { logger } from "@/lib/logger";

// Synchronous operation
const result = logger.timed("Database query", () => {
  return db.query("SELECT * FROM users");
});

// Async operation (returns Promise)
const videos = await logger.timed("Fetch videos", async () => {
  return await videoService.getAll();
}, { level: "debug" });
```

## Request Context

The logger automatically captures request context when using the middleware:

```typescript
import { withRequestContext, generateRequestId } from "@/lib/logger";

// Wrap request handling
withRequestContext({ requestId: generateRequestId() }, () => {
  // All logs within this context include the requestId
  logger.info("Processing request");
});
```

The middleware automatically:
- Generates unique request IDs
- Logs incoming requests with method, path, IP
- Adds `x-request-id` header to responses
- Logs rate limit events

## Output Format

<Tabs>
  <Tab title="Development (Pretty-printed)">
    ```
    [INFO] 2024-01-15 10:30:45 Processing video (abc-123) [245ms]
      Data: { videoId: "video-001" }
    ```
  </Tab>
  <Tab title="Production (JSON)">
    ```json
    {
      "level": "info",
      "time": "2024-01-15T10:30:45.123Z",
      "service": "nuclom",
      "environment": "production",
      "requestId": "abc-123",
      "durationMs": 245,
      "videoId": "video-001",
      "msg": "Processing video"
    }
    ```
  </Tab>
</Tabs>

## Best Practices

### Do

```typescript
// Include structured data
log.info({ userId, action: "login", ip }, "User logged in");

// Use appropriate log levels
log.debug({ query }, "Executing query");    // Debug only
log.info({ orderId }, "Order created");     // Normal operations
log.warn({ attempts: 3 }, "Multiple login failures");
log.error({ err: error }, "Request failed"); // Always include err for errors

// Use component loggers
const log = createLogger("billing");
```

### Don't

```typescript
// Don't use console.log - use logger instead
console.log("Something happened"); // Bad
logger.info("Something happened"); // Good

// Don't include sensitive data
log.info({ password }, "User registered"); // Bad
log.info({ userId }, "User registered");   // Good

// Don't use string concatenation
log.info("User " + userId + " logged in"); // Bad
log.info({ userId }, "User logged in");    // Good
```

## Integration with Error Handling

The logger integrates with the Effect runtime for automatic error logging:

```typescript
// In effect/runtime.ts
log.error({ tag: error._tag, message: error.message }, "Service error");
```

## Middleware Logging

The Next.js middleware automatically logs:
- Incoming API requests
- Request duration
- Rate limit events
- Client IP and user agent

Example output:
```
-> POST /api/videos
<- POST /api/videos 201 (245ms)
```

## Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `LOG_LEVEL` | Minimum log level | `debug` (dev), `info` (prod) |
| `NODE_ENV` | Controls output format | `development` |

## Viewing Logs

<Tabs>
  <Tab title="Development">
    Logs are printed to the console with colors and formatting.
  </Tab>
  <Tab title="Production (Vercel)">
    <Steps>
      <Step title="Open Vercel dashboard">
        Go to your Vercel project dashboard
      </Step>
      <Step title="Navigate to logs">
        Navigate to **Deployments** > Select deployment > **Logs**
      </Step>
      <Step title="Use JSON mode">
        Use JSON mode for structured filtering
      </Step>
    </Steps>
  </Tab>
</Tabs>

### Log Aggregation Services

The JSON format is compatible with:
- Vercel Log Drains
- Datadog
- Logtail
- Better Stack
- Papertrail

## Next Steps

<CardGroup cols={2}>
  <Card title="Data Integrity" icon="shield-check" href="/internal/reference/data-integrity">
    Learn about data integrity measures
  </Card>
  <Card title="Testing" icon="flask" href="/internal/reference/testing">
    Set up testing for your code
  </Card>
</CardGroup>
